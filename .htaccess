# Abilita il modulo di riscrittura
RewriteEngine On

# Redirect da HTTP a HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# Forza la rimozione di www
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Disabilita l'accesso ai file sensibili
<FilesMatch "\.(env|htaccess|ini|log|sh|sql|bak|old|json)$">
    Require all denied
</FilesMatch>

# Blocca la visualizzazione delle directory
Options -Indexes

# Compressione gzip
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Prevenzione hotlinking
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https?://pietroperona\.it [NC]
RewriteRule \.(jpg|jpeg|png|gif|svg|webp)$ - [F,NC,L]

# Pagina personalizzata per errori 404
ErrorDocument 404 /404.html

# Prevenzione attacchi XSS
<IfModule mod_headers.c>
    Header set X-XSS-Protection "1; mode=block"
    Header set X-Content-Type-Options "nosniff"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Prevenzione clickjacking
<IfModule mod_headers.c>
    Header always append X-Frame-Options SAMEORIGIN
</IfModule>

# Limita il crawling aggressivo
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_USER_AGENT} (AhrefsBot|SemrushBot|MJ12bot) [NC]
    RewriteRule .* - [F,L]
</IfModule>